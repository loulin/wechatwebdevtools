"use strict";function init(){var e=require("../../lib/react.js"),t=require("../../cssStr/cssStr.js"),s=require("../../stroes/windowStores.js"),a=(require("../../actions/windowActions.js"),require("../../actions/webviewActions.js")),i=1,r=2,n=3,o=4,c=5,u=e.createClass({displayName:"Music",_initMusic:function(){var e=document.createElement("audio");document.body.appendChild(e),this.audio=e;var t=this;e.addEventListener("play",function(){t.setState({musicState:r}),a.postMessageToAS({eventName:"onMusicPlay",type:"ON_MUSIC_EVENT",data:{dataUrl:e.src}})}),e.addEventListener("pause",function(){t.audio.error||t.setState({musicState:n}),a.postMessageToAS({eventName:"onMusicPause",type:"ON_MUSIC_EVENT",data:{dataUrl:e.src}})}),e.addEventListener("ended",function(){t.setState({musicState:o}),a.postMessageToAS({eventName:"onMusicEnd",type:"ON_MUSIC_EVENT",data:{dataUrl:e.src}})}),e.addEventListener("error",function(s){t.setState({musicState:c}),a.postMessageToAS({eventName:"onMusicError",type:"ON_MUSIC_EVENT",data:{dataUrl:e.src,errMsg:"Error: "+e.error.code}})})},getInitialState:function(){return this._initMusic(),{showPlayer:!1,musicState:i,title:"未知",singer:"未知"}},_play:function(e){var t=this.audio;e.dataUrl&&(t.src=e.dataUrl,t.play(),t.currentTime=0),this.setState({title:e.title||"未知",singer:e.singer||"未知"})},_resume:function(e){var t=this.audio;t.paused&&t.play()},_pause:function(e){var t=this.audio;t.paused||t.pause()},_seek:function(e){var t=this.audio;t.paused||(t.currentTime=1*e.position)},_stop:function(){var e=this.audio;e.currentTime=e.duration},_getMusicPlayState:function(e){var t=this.audio,s={dataUrl:t.src,duration:t.duration,currentPosition:t.currentTime,status:t.paused?0:1,downloadPercent:Math.round(100*t.buffered.end(0)/t.duration)};return e&&e(s),s},_operateMusicPlayer:function(e){"play"==e.operationType?(this._play(e),this.setState({showPlayer:!0})):"resume"==e.operationType?this._resume(e):"pause"==e.operationType?this._pause(e):"seek"==e.operationType?this._seek(e):"stop"==e.operationType&&this._stop(e)},componentDidMount:function(){s.on("GET_MUSIC_PLAY_STATE",this._getMusicPlayState),s.on("BODY_CLICK",this._bodyClick),s.on("OPERATE_MUSIC_PLAY",this._operateMusicPlayer)},componentWillUnmount:function(){s.removeListener("GET_MUSIC_PLAY_STATE",this._getMusicPlayState),s.removeListener("BODY_CLICK",this._bodyClick),s.removeListener("OPERATE_MUSIC_PLAY",this._operateMusicPlayer)},_bodyClick:function(e){this.setState({showPlayer:!1})},stop:function(e){this._stop()},_showOrHide:function(e){this.setState({showPlayer:!this.state.showPlayer}),e.stopPropagation(),e.preventDefault()},_playOrPause:function(e){this.state.musicState==n?this._resume():this._pause(),e.stopPropagation(),e.preventDefault()},render:function(){var s=this.state.musicState==r||this.state.musicState==n?{}:t.displayNone,a=this.state.showPlayer?{}:t.displayNone,i=this.state.musicState==n?{}:t.displayNone,o=this.state.musicState==r?{}:t.displayNone;return e.createElement("div",{style:s,title:"音乐控件",onClick:this._showOrHide,className:"sidebar-item"},e.createElement("i",{className:"sidebar-item-icon  sidebar-item-icon-music"}),e.createElement("label",{className:"sidebar-item-label"},"音乐"),e.createElement("div",{className:"music-card",style:a,onClick:this._playOrPause},e.createElement("div",{className:"music-card-main"},e.createElement("p",{className:"music-card-status"},"正在播放"),e.createElement("p",{className:"music-card-name"},this.state.singer," - ",this.state.title)),e.createElement("div",{className:"music-card-opr"},e.createElement("i",{className:"music-card-play-icon",style:i}),e.createElement("i",{className:"music-card-pause-icon",style:o}))))}});_exports=u}var _exports;init(),module.exports=_exports;