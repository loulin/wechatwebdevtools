"use strict";function init(){var e=require("../../lib/react.js"),n=require("../../common/request/request.js"),t=(require("../../cssStr/cssStr.js"),require("../../actions/windowActions.js")),r=require("../../common/log/log.js"),i=require("../../config/urlConfig.js"),o="darwin"===process.platform?"darwin":"win",a=e.createClass({displayName:"Lunch",handleOnClick:function(){this.props.appQuit()},componentWillUnmount:function(){this.refs.container.innerHTML=""},_loadstop:function(e){var i=this,a=this.webview;a.executeScript({code:"\n            var s = document.createElement('style')\n            s.innerText = `\n              body{\n                overflow:hidden;\n                background-color: #f0f0f0!important;\n                padding: inherit!important;\n                color: #373737!important;\n              }\n              .impowerBox .title {\n                display: none;\n              }\n              .impowerBox .qrcode {\n                width: 170px;\n                height: 170px;\n                margin-top: -7px;\n              }`\n              document.head.appendChild(s)\n              var normal = document.querySelectorAll('.normal')\n              for(var i = 0; i < normal.length; i++) {\n                normal[i].classList.remove('normal')\n              }\n          "}),a.style.display="block";var s=a.request;s.onBeforeRequest.addListener(function(e){if("main_frame"!==e.type)return{};var s=e.url;return s=s.replace("state=login","state="+o),r.info("LoginLayerview.js get URL : "+s),n({url:s},function(e,n,o){if(e)alert("网络错误 "+e.toString()),a.removeEventListener("loadstop",i._loadstop),i.componentDidMount();else{o=JSON.parse(o);var s=o.baseresponse,l=s.errcode?parseInt(s.errcode):0;if(0!==l)return alert("登录失败，错误信息："+s.errmsg),a.removeEventListener("loadstop",i._loadstop),void i.componentDidMount();for(var c in localStorage)0===c.indexOf("projectattr")&&delete localStorage[c];r.info("LoginLayerview.js get res "+o);var d=n.headers,m=d["debugger-signature"],p=d["debugger-newticket"],u=+new Date,v={signature:m,newticket:p,openid:o.openid,nickName:o.nickname,headUrl:o.headurl||"../images/account.png",ticketExpiredTime:1e3*o.ticket_expired_time+u,signatureExpiredTime:1e3*o.signature_expired_time+u,sex:1===o.sex?"male":"female",province:o.province,city:o.city,contry:o.contry};t.upDateUserInfo(v)}}),{cancel:!0}},{urls:["<all_urls>"]},["blocking"]),r.info("LoginLayerview.js init loginWebview")},componentDidMount:function(){var e=(this.refs.container,this.webview=document.createElement("webview"));e.src=i.LOGIN_URL,e.style.display="none",e.addEventListener("loadstop",this._loadstop),this.refs.container.innerHTML="",this.refs.container.appendChild(e)},render:function(){return e.createElement("div",{className:"lunch"},e.createElement("div",{className:"lunch-toolbar app-drag"},e.createElement("a",{onClick:this.handleOnClick,href:"javascript:;",className:"lunch-toolbar-close app-no-drag"},e.createElement("i",{className:"lunch-toolbar-close-icon app-no-drag"}))),e.createElement("div",{className:"lunch-body"},e.createElement("div",{className:"lunch-logo-wrapper"},e.createElement("i",{className:"lunch-logo"})),e.createElement("div",{className:"lunch-name"},"微信开发者工具"),e.createElement("div",{className:"lunch-line"}),e.createElement("div",{ref:"container",className:"lunch-qrcode"})))}});_exposts=a}var _exposts;init(),module.exports=_exposts;