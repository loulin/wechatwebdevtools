"use strict";function init(){var e=global.appConfig.isDev,r=(require("./trans/transConfigToPf.js"),require("./trans/transWxmlToJs.js"),require("./trans/transWxmlToHtml.js"),require("./trans/transManager.js")),s=require("./utils/tools.js"),i=(require("async"),require("fs")),t=require("path"),p=require("url"),n=require("./utils/vendorManager.js"),c=(require("glob"),require("./utils/projectManager.js")),a=require("../config/appserviceConfig.js"),o=require("../stroes/projectStores.js"),u=require("./tpl/errorTpl.js"),l=require("./tpl/appserviceErrorTpl.js"),j=t.join(__dirname,"appservice/asdebug.js"),f=i.readFileSync(j,"utf8"),v=t.join(__dirname,"appservice/ascheck.js"),g=i.readFileSync(v,"utf8"),d=s.noBrowser.join(",");_exports.getAppservice=function(r,j){var v=s.getProject(r),h=p.parse(r),q=h.pathname,_=/appservice$/.test(q),m=/appservice-sdk\.js$/.test(q),x=/asdebug\.js$/.test(q),w=/ascheck\.js$/.test(q),S=/webnode\.js$/.test(q),C=/reporter-sdk\.js/.test(q),F=/app_service_engine\.js/.test(q),y=(/\.js$/.test(q),/\.js\.map$/.test(q)),b=/WAService\.js/.test(q),k=(v.appname.toLowerCase(),v.appid.toLowerCase(),v.hash),$=void 0;try{$=s.getProjectConfig(v)}catch(T){var A=u.replace(/{{error}}/g,function(){return JSON.stringify(T)});return void j(500,{},A)}var J=o.getProjectConfig(v);$.projectConfig=J,$.appserviceConfig=a;var W=$.pages||[];if(_)!function(){var r=require("./tpl/appserviceTpl.js"),s="http://"+k+".appservice.open.weixin.qq.com/",i=[],t=[],p=[];c.getAllJSFileList(v,function(n,c){for(var a={},o=0,u=W.length;o<u;o++){var l=W[o]+".js";a[l]=!0,i.push("<script>__wxRoute = '"+W[o]+"';__wxRouteBegin = true</script>"),i.push('<script src="'+s+l+'"></script>')}for(var f=0,g=c.length;f<g;f++){var d=c[f];a[d]||("app.js"===d?p.push('<script src="'+s+d+'"></script>'):t.push('<script src="'+s+d+'"></script>'))}i=t.concat(p).concat(i),e?(i.unshift('<script src="'+s+'app_service_engine.js"></script>'),i.unshift('<script src="'+s+'reporter-sdk.js"></script>'),i.unshift('<script src="'+s+'appservice-sdk.js"></script>'),i.unshift('<script src="'+s+'webnode.js"></script>')):i.unshift('<script src="'+s+'WAService.js"></script>'),i.unshift('<script src="'+s+'asdebug.js"></script>'),$.appname=v.appname,$.appid=v.appid,$.apphash=v.hash,i.unshift("<script>var __wxConfig = "+JSON.stringify($)+"</script>"),r=r.replace("<script></script>",i.join("")),j(null,{},r)})}();else if(b)j(null,{},n.getFile("WAService.js"));else if(C)j(null,{},n.getFile("reporter-sdk.js"));else if(F)j(null,{},n.getFile("app_service_engine.js"));else if(m)j(null,{},n.getFile("appservice-sdk.js"));else if(x)j(null,{},f);else if(w)j(null,{},g);else if(S)j(null,{},n.getFile("webnode.js"));else if(y)!function(){var e=t.join(v.projectpath,q);i.readFile(e,function(r,s){return r?void j(404,{},"do not find "+e):void j(200,{},s)})}();else{var O=r.replace("http://"+k+".appservice.open.weixin.qq.com/",""),P=t.join(v.projectpath,O),R=void 0;try{R=i.readFileSync(P,"utf8"),R="app.js"===O||W.indexOf(O.replace(/\.js/,""))!==-1?'define("'+O+'", function(require, module){var '+d+";\n"+R+'\n});require("'+O+'")':'define("'+O+'", function(require, module){var '+d+";\n"+R+"\n})",j(null,{},R)}catch(T){R=l.replace("{{error}}",JSON.stringify(T)),j(null,{},R)}}},_exports.getResponse=function(e,s){r.getResponse(e,s)}}var _exports={};init(),module.exports=_exports;