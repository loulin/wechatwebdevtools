"use strict";function init(){var e=require("url"),n=require("os"),t=require("path"),o=require("fs"),i=require("net"),r=require("../common/log/log.js"),a=require("async"),s=require("child_process").exec,c=(require("rmdir"),require("../config/config.js"),require("../config/dirConfig.js")),l=(nw.App,{}),p=!1,u=9973,f="darwin"===process.platform;_exports={parseURL:function(e){var n=/^http(s)?:\/\//;return n.test(e)?e:"http://"+e},getAvailablePort:function(e,n){function t(e){var n=u,o=i.createServer();o.listen(n,function(t){o.once("close",function(){u=n+1,e(null,n)}),o.close()}),o.on("error",function(o){r.info("tools.js getAvailablePort error "+n),u++,t(e)})}for(var o=[],s=0;s<n;s++)o.push(t);a.series(o,function(n,t){r.info("tools.js getAvailablePort success "+JSON.stringify(t)),e(t)})},getAppConfig:function(){var e=nw.App.getDataPath(),n=t.join(e,"..","config.json"),i={isDev:!!process.execPath.match("nw.exe")||!!process.execPath.match("nwjs.app")},a=o.existsSync(n);if(!a)return i;try{i=JSON.parse(o.readFileSync(n))}catch(s){}return r.info("tools.js getAppConfig: "+JSON.stringify(i)),i.isDev=i.isDev||!!process.execPath.match("nw.exe")||!!process.execPath.match("nwjs.app"),i.onLine=!1,i},getArgsURL:function(e){var n=Array.isArray(e);n||(e=e.split(" "));var t=e.find(function(e){return 0===e.indexOf("href://")});if(t){var o=t.replace("href://","");return this.parseURL(o)}},getSysIpInfo:function(){var e=n.networkInterfaces(),t=[];return Object.keys(e).forEach(function(n){var o=0;e[n].forEach(function(e){"IPv4"===e.family&&e.internal===!1&&(o>=1||t.push(e.address))})}),r.info("index.js getSysIpInfo: "+JSON.stringify(t)),t},openInspectWin:function(e){var n=require("path");nw.Window.open("about:blank",{show:!1,width:799,height:799,inject_js_end:n.join(__dirname,"../inject/chromeInspect.js")},function(e){e.maximize(),e.window.location="chrome://inspect/#devices",e.show(),r.info("index.js openInspectWin")})},clearProxyCache:function(){l={}},getProxyForURL:function(n){var t=e.parse(n);return n=t.protocol+"//"+t.hostname,l[n]?r.info("tools.js getProxyForURL "+n+" from proxyCache: "+l[n]):(l[n]=nw.App.getProxyForURL(n),r.info("tools.js getProxyForURL "+n+" from nw.App.getProxyForURL: "+l[n])),l[n]},getVersionNum:function(e){return e=e||nw.App.manifest.version,e=e.replace(/\./g,""),parseInt(e)},hasNewVersion:function(e){var n=e.clientConfig.last_version,t=nw.App.manifest.version;if(t===n||!n)return{};t=t.split(".");for(var o=n.split("."),i=0,r=o.length;i<r;i++){if(parseInt(o[i])>parseInt(t[i])){var a=e.urlConfig.webdebugger_download+"?from=tools&cv="+this.getVersionNum();return a+="darwin"===process.platform?"&os=darwin":"x64"===process.arch?"&os=x64":"&os=x86",{last_version:n,downloadURL:a}}if(parseInt(o[i])<parseInt(t[i]))return{}}},notifications:function(e,n,t,o){var i=(+new Date).toString();return o=o||function(){},t=t||[],p||(p={},chrome.notifications.onButtonClicked.addListener(function(e,n){p[e]&&p[e](n)})),p[i]=o,chrome.notifications.create(i,{type:"basic",iconUrl:"app/images/logo.png",title:e,message:n,buttons:t}),i},up:function(e){var n=global.appVersion=nw.App.manifest.version;if(global.appConfig.isDev)return void e();var o=localStorage.getItem("new-version"),i=this.getVersionNum(o),a=this.getVersionNum();a<i?!function(){var i=function(n,t,i){n?(p.innerHTML='<div class="app-up-data">更新失败</div>',setTimeout(function(){e()},3e3)):(p.innerHTML="",global.appVersion=o,p.innerHTML='<div class="app-up-data">更新成功，当前版本 '+o+"</div>",global.contentWindow.title="微信web开发者工具 v"+o,global.Win.title="微信web开发者工具 v"+o,setTimeout(function(){e(),nw.Shell.openExternal("https://mp.weixin.qq.com/wxopen/wawiki?action=dir_list&type=develop&lang=zh_CN")},1e3),delete localStorage["new-version"]),delete localStorage["new-version"]};r.info("tools.js currentVersion: "+n+" newVersion: "+o+" ");var a=c.WeappApplication,l=f?t.join(a,o,"app.nw"):t.join(a,o,"package.nw"),p=global.contentDocument.querySelector("#container");if(p.innerHTML='<div class="app-up-data">更新中...</div>',f){var u=t.join(__dirname,"../../../../");s('cp -r "'+l+'" "'+u+'"',i)}else{var d=require("node-windows"),g='xcopy "'+l+'" "'+t.join(process.execPath,"..","package.nw")+'" /s /e /y /i';d.elevate(g,i)}}():e()},chooseFile:function(e){var n=document.createElement("input");n.style.display="none",n.setAttribute("type","file"),e.accept&&n.setAttribute("accept",e.accept),e.dir&&n.setAttribute("nwdirectory",!0),e.multiple&&n.setAttribute("multiple","multiple"),global.contentDocumentBody.appendChild(n),n.addEventListener("change",function(t){e.sucCall&&e.sucCall(t),global.contentDocumentBody.removeChild(n)}),n.addEventListener("cancel",function(t){e.cancelCall&&e.cancelCall(t),global.contentDocumentBody.removeChild(n)}),n.click()}}}var _exports;init(),module.exports=_exports;