"use strict";function init(){function e(e){if(void 0===e.device)t="iOS"===e.os?s.defaultUa:s.Android_useragent,a=375,v=627,w=2;else{var i=_[e.device];t=i["user-agent"],a=i.screen.vertical.width,v=i.screen.vertical.height-40,w=i.screen["device-pixel-ratio"]}t=t.replace("{{version}}",e.version)}var t,i=require("events").EventEmitter,r=require("../common/jssdk/sdk.js"),n=require("../common/getA8key/getA8key.js"),o=require("../config/errcodeConfig.js"),s=require("../config/config.js"),S=require("../common/log/log.js"),_=require("../config/DeviceModules.js"),u={},c={},f=0,E="iPhone 6",a=375,v=627,w=2,I="app/html/about.html",m={},A=localStorage["webview-network-type"]?localStorage["webview-network-type"]:"wifi",T=JSON.parse(localStorage.getItem("setting"));T?e(T):t=s.defaultUa.replace("{{version}}",s.defaultWechatVersion);var g=Object.assign({},i.prototype,{addWebviewPorts:function(e,t){return m[e]=t,m},delWebviewPorts:function(e){return delete m[e],m},getNetworkType:function(){return A},setNetworkType:function(e){A=e,localStorage["webview-network-type"]=A},getWebviewPorts:function(){return m},deleteWebviewID:function(e){S.info("webviewStores.js deleteWebviewID "+e),this.emit("DELETE_WEBVIEW_ID",e)},changeWebviewID:function(e){f=e,S.info("webviewStores.js changeWebviewID "+e),this.emit("CHANGE_WEBVIEW_ID",e)},getSnapShot:function(e){return c[e]},setSnapShot:function(e,t){c[e]=t,this.emit("SET_WEBVIEW_SNAPSHOT",e,t)},getInitURL:function(){return I},setInitURL:function(e){I=e},upErrNum:function(e,t){this.emit("UP_WEBVIEW_ERRNUM",e,t)},getUA:function(){return t},setUA:function(i){e(i),S.info("webviewStores.js setUA "+t),this.emit("SET_WEBVIEW_UA",t)},setInfo:function(e){S.info("webviewStores.js setInfo "+JSON.stringify(e)),E=e.device,v=e.height,a=e.width,w=e.dpr,this.emit("SET_WEBVIEW_INFO",e)},getInfo:function(){return{model:E,dpr:w,width:a,height:v}},getOffset:function(){return{height:v,width:a,dpr:w}},getCurrentWebviewID:function(){return f},showShare:function(e,t){this.emit("SHOW_SHARE_WEBVIEW_"+e,e,t)},upStatus:function(e,t){u[e]||(u[e]={}),this.emit("UP_WEBVIEW_STATUS_"+e,e,t),this.emit("UP_WEBVIEW_STATUS",e,t)},setAction:function(e,t){u[e]||(u[e]={}),this.emit("SET_WEBVIEW_ACTION_"+e,e,t)},execJSSDK:function(e,t){var i=this;u[e]||(u[e]={}),S.info("webviewStores.js execJSSDK begin: "+e+" "+JSON.stringify(t)),r.exec(t,u[e],function(r,n,s){var _=t.sdkName,c=s.type;if(S.info("webviewStores.js execJSSDK end: "+e+" "+_+" "+c+" "+r+" "+JSON.stringify(n)+" "+JSON.stringify(s)),"CARD_SDK"===c&&r){var f=s.error;if(f){if(f.errcode===o.NOT_LIMITS_CARD)return S.info("webviewStores.js getA8key NOT_LIMITS_CARD"),void i.emit("NOT_LIMITS_CARD");if(0!==f.errcode){S.info("webviewStores.js getA8key "+f.errcode);var E=require("../common/jssdk/sdkNameTrans.js");return n={errMsg:E.getSdkDisplayName(_)+":fail"},i.emit("GET_JSSDK_RES_"+e,e,_,n,t.ext),void i.setJSSDKLog(e,t,r,n,s)}}else i.emit("CRAD_SDK_RES",e,_,n,r,t)}else"PREVERIFY_SDK"===c?(u[e].purviewFromPreVerify=s.purviewFromPreVerify||{},i.emit("GET_JSSDK_RES_"+e,e,_,n,t.ext)):"SHARE_SDK"===c?i.emit("SHOW_SHARE_WEBVIEW_"+e,e,t,n):"REGISTER_SDK"===c||("INTERFACE_SDK"===c?(i.emit("SET_INTERFACE_RES_"+e,e,_,r,t),i.emit("GET_JSSDK_RES_"+e,e,_,n,t.ext)):"WEBVIEW_SDK"===c?(i.emit("WEBVIEW_SDK",e,t,_,n),i.emit("GET_JSSDK_RES_"+e,e,_,n,t.ext)):i.emit("GET_JSSDK_RES_"+e,e,_,n,t.ext)),i.setJSSDKLog(e,t,r,n,s)})},sendJSSDKRes:function(e,t,i,r){this.emit("GET_JSSDK_RES_"+e,e,t,i,r)},setJSSDKLog:function(e,t,i,r,n){this.emit("GET_JASSDK_LOG",e,t,i,r,n),this.emit("GET_JASSDK_LOG_"+e,t,i,r,n)},getA8key:function(e,t){var i=this;u[e]={};var r=t.isSync;S.info("webviewStores.js getA8key begin: "+e+" "+JSON.stringify(t)),n.get(t,function(n){S.info("webviewStores.js getA8key end: "+JSON.stringify(n));var s=n.baseresponse,_=parseInt(s.errcode);if(S.info("webviewStores webview %s getA8keyRes %s %s",e,JSON.stringify(n)),_===o.NOT_LOGIN)return S.info("webviewStores.js getA8key NOT_LOGIN"),void i.emit("NOT_LOGIN");if(_===o.NOT_LIMITS)return S.info("webviewStores.js getA8key NOT_LIMITS"),void i.emit("NOT_LIMITS");if(_===o.NOT_LIMITS_QY)return S.info("webviewStores.js getA8key NOT_LIMITS_QY"),void i.emit("NOT_LIMITS_QY");if(_===o.INVALID_LOGIN||_===o.INVALID_TOKEN)return S.info("webviewStores.js getA8key INVALID_LOGIN"),void i.emit("INVALID_LOGIN");u[e].purviewFormGetA8key=n.purviewFormGetA8key;var c=n.resp_url;if(r||_===o.ILLEGAL_URL)return void setTimeout(function(){i.emit("SET_WEBVIEW_ACTION_"+e,e,{act:"load",url:c,from:t.from})});if(0!==_){S.info("webviewStores.js getA8key "+_);var f=require("../actions/windowActions.js");return void f.showTipsMsg("系统错误， 错误码 "+_)}var E=/\#wechat_redirect$/.test(t.url);return E&&t.url.replace(/\#wechat_redirect$/,"")===c?(c=c.replace(/\#wechat_redirect/,""),S.info("webviewStores.js getA8key GETA_8KEY_NOT_SUPPORT "+c),void i.emit("GETA_8KEY_NOT_SUPPORT",e,c)):void 0})},getWebviewByID:function(e){return u[e]},clearData:function(e){this.emit("CLEAR_WEBVIEW_DATA",e)},setInterfaceFromPageFrame:function(e,t){this.emit("SET_INTERFACT_FROMPAGEFRAME_"+e,t)},cleanWebview:function(e){this.emit("CLEAN_WEBVIEW_"+e),this.emit("CLEAN_WEBVIEW",e)},asTojs:function(e){this.emit("AS_TO_JS",e)},upASData:function(e,t){this.emit("UP_AS_DATA",e,t)},asPublish:function(e){this.emit("AS_PUBLISH",e)},postMessageToAS:function(e){this.emit("POST_MSG_TOAS",e)},sendASSdk:function(e,t,i){this.emit("SEND_AS_SDK",e,t,i)},authorizeSdkShowDialog:function(e,t,i,r,n){this.emit("SHOW_AUTHORIZE_SDK_DIALOG_"+e,e,t,i,r,n)},authorizeSdkReturn:function(e,t,i){this.emit("AUTHORIZE_SDK_RETURN_"+e,e,t,i)},showScanCodeDialog:function(e){this.emit("SHOW_SCAN_CODE_DIALOG",e)},scanCodeReturn:function(e){this.emit("SCAN_CODE_RETURN",e)}}),d=g.on,h={};g.on=function(){var e=arguments,t=e[0];h[t]||(h[t]=0),h[t]++,h[t]>=10&&S.error("webviewStores.js on "+t+" - times: "+h[t]),d.apply(this,arguments)};var D=g.removeListener;g.removeListener=function(){var e=arguments,t=e[0];h[t]&&h[t]--,h[t]>=10&&S.error("webviewStores.js on "+t+" - times: "+h[t]),D.apply(this,arguments)},_exports=g}var _exports;init(),module.exports=_exports;